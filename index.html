<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Wire | Real-time News</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js" defer></script>
</head>
<body class="bg-slate-900 text-slate-100 font-sans antialiased min-h-screen">

    <div x-data="newsFeed()" x-init="init()" class="container mx-auto px-4 py-8 max-w-7xl">
        
        <div class="flex flex-col md:flex-row justify-between items-center mb-10 border-b border-slate-800 pb-6">
            <div>
                <h1 class="text-4xl font-black tracking-tighter text-white">
                    GLOBAL<span class="text-blue-500">WIRE</span>.
                </h1>
                <p class="text-slate-400 text-sm mt-1">Live Intelligence Feed</p>
            </div>
            
            <div class="mt-4 md:mt-0 relative w-full md:w-80">
                <input 
                    x-model="search" 
                    type="text" 
                    placeholder="Search news..." 
                    class="w-full bg-slate-800 border border-slate-700 rounded-lg py-2 px-4 text-white focus:outline-none focus:border-blue-500 transition"
                >
            </div>
        </div>

        <div x-show="error" class="bg-red-900/50 border border-red-500 text-red-200 p-4 rounded mb-6 text-center">
            <p class="font-bold">Error loading news.</p>
            <p class="text-sm">Make sure the GitHub Action has run successfully at least once.</p>
        </div>

        <div x-show="loading" class="text-center py-20 text-slate-500 animate-pulse">
            Loading latest headlines...
        </div>

        <div x-show="!loading && !error" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <template x-for="article in filteredItems" :key="article.link">
                <a :href="article.link" target="_blank" class="block bg-slate-800 rounded-xl overflow-hidden border border-slate-700 hover:border-blue-500 hover:shadow-lg transition duration-300 flex flex-col h-full group">
                    
                    <div class="p-5 flex flex-col h-full">
                        <div class="flex justify-between items-start mb-3">
                            <span class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wide bg-blue-900 text-blue-300" x-text="article.source"></span>
                            <span class="text-slate-500 text-xs" x-text="article.date"></span>
                        </div>

                        <h2 class="text-lg font-bold leading-snug mb-2 group-hover:text-blue-400 transition" x-text="article.title"></h2>
                        
                        <p class="text-slate-400 text-sm leading-relaxed mb-4 line-clamp-3" x-text="article.summary"></p>
                    </div>
                </a>
            </template>
        </div>

        <div x-show="!loading && filteredItems.length === 0" class="text-center py-20 hidden" :class="{'!block': !loading && filteredItems.length === 0}">
            <p class="text-slate-500">No stories found.</p>
        </div>
    </div>

    <script>
        function newsFeed() {
            return {
                items: [],
                search: '',
                loading: true,
                error: false,
                
                async init() {
                    console.log("Attempting to fetch news.json...");
                    try {
                        // This forces the browser to get a fresh version of the file
                        const response = await fetch('./news.json?t=' + new Date().getTime());
                        
                        if (!response.ok) throw new Error('File not found');
                        
                        this.items = await response.json();
                        this.loading = false;
                        console.log("Loaded " + this.items.length + " articles.");
                    } catch (e) {
                        console.error("Fetch failed:", e);
                        this.error = true;
                        this.loading = false;
                    }
                },

                get filteredItems() {
                    if (this.search === '') return this.items;
                    const q = this.search.toLowerCase();
                    return this.items.filter(i => 
                        (i.title && i.title.toLowerCase().includes(q)) || 
                        (i.summary && i.summary.toLowerCase().includes(q))
                    );
                }
            }
        }
    </script>
</body>
</html>
